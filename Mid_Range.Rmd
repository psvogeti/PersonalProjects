---
title: "NBA and the Mid-Range"
author: "Pranav Vogeti"
date: "2024-01-07"
output: 
  html_document:
    css: customOutputScript.css
    toc: true
    toc_float: true
---

```{r message = FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lubridate)
library(kableExtra)
library(sportyR)
```


# Introduction

As we inch closer to the NBA All-Star Game, a game of absent defense and HIGH scoring offense, I was interested in analyzing how the Mid-Range shot in the NBA has evolved over time.


### The Focus Question

How has the mid-range shot in the NBA changed over time, and are there any influences that have mediated this particular shot's volume?

### Motivation

There are many different types of offensive plays in the NBA. Some plays are designed for guards to drive the ball into the basket. Some plays are designed for a quick three point shot. Some plays are designed to wear out the defense before making a decision on what shot to take. 

There are different types of shots in an NBA game. The dunk, the layup, paint shots, the free throw, the three point shot, and the focus of this report: the mid-range. In the early years of the modern NBA (80s-90s), the three point shot was more or less a privilege and an advantage for the undersized guard. Offenses at that time were largely based on physicality and paint-presence. Not many three point shots were taken and were treated as fall back options. Interestingly, if one were to turn on an NBA game now, that is not the case. Even the NBA's big men have developed a competitve jump shot to add an extra dynamicism to their offensive capabilities. Players like Nikola JokiÄ‡, Karl-Anthony Towns, Brook Lopez, Joel Embiid, and many other counterparts are prime examples of this evolution. In fact, in the 2022 three point contest, it was the big man Karl-Anthony Towns that won the infamous shooting contest! Towns was only the third big man to do so, behind very famous players like Dirk Nowitzki and Kevin Love. [^1]

[^1]: https://sports.yahoo.com/minnesota-timberwolves-center-karl-anthony-towns-wins-nba-all-star-3-point-contest-025319348.html

The three point shot has become so commonplace that it is hard to find plays that use the mid-range. If the league's big men have credible three-point shots, defenses get spread out in the half-court as now every offensive player can get a three over a two. A spread out defense also leaves gaping holes that, when properly accounted for by the offense, allows guards to simply drive the ball to the paint for a layup, or dunk, or a chance at the free-throw line. Thus, it is worth investigating the presence (or lackthereof, potentially) of the mid-range and its relations to the three point shot. 

# Background

### About the Original Data: Play-by-Play

The author that has provided the data for us to use is Vladislav Shufinsky. He has compiled NBA play-by-play data from 1996-2022 and made it open-source on Kaggle to allow us to use it for excursions like this[^2].

[^2]: <https://www.kaggle.com/datasets/brains14482/nba-playbyplay-and-shotdetails-data-19962021/data>

The data set we will use will contain a whole season's log of play-by-play data. In order to see changes over time, we will use the collection available from this data set. This collection spans from the 2015-2016 NBA season to the 2021-2022 NBA season inclusive. While the entire dataset consists of four subdata sets, we will choose to use the data originally sourced from *data.nba.com* This means that we will use the files called "*datanba_YYYY.csv*" where YYYY is the season of choice. So, the 2015-2016 season uses the "*datanba_2016.csv*

### The Key Variables

-   The key variables from the *Play-By-Play* we will use for this excursion:
    -   `cl` the time stamp at which the significant play occurred
    -   `de` the short form description of what the play was
    -   `locX` the x-coordinate location of the `de` play
    -   `locY` the y-coordinate location of the `de` play
    -   `hs` the home team total points at the `cl` moment
    -   `vs` the visiting team total points at the `cl` moment
    -   `PERIOD` the quarter of the game so as to distinct `cl`
    -   `GAME_ID` the numerical identifier of the game being played

### Assumptions and Unusuality

A giant aspect of this report relies on the location data: `locX` and `locY`. The way we define the type of shot performed agrees with the NBA standard. However, there are certainly edge cases where we classify a shot differently when compared to the actual scorekeeper's book. Such edge cases are rare, but can and will happen during this excursion. An example of this case can be found in Game 6 of the 2021 NBA Eastern Conference Finals, when the Bucks played the Nets. In that game, Kevin Durant took a shot that had merits to be a three, but was ruled as a two because of his shoe being on the three point line. We will interpret all shots that show on the marking lines as a two, even if some of them were ruled as a three. 

Another aspect of this report is that we are not necessarily evaluating the player's position. This is more of a holistic look at the shot architecture rather than a case-by-case shot outlook. So, a shot taken at the three point line by a Center will be treated the exact same as that shot taken by a Point Guard. We are just interested in looking at a broad look at shot behavior without delving too much into particulars. 

### Report Intentions

The rest of this report will focus on cleaning the data to fit our needs, and analyzing said data and fostering meaningful observations and conclusions. 


# Analysis

### Data Cleanup

#### Getting the Shots

First we load in the data. 
```{r load-data}
# read the play by play data. this is an expensive chunk to load so run sparingly
raw_pbp_2016_data <- read.csv("../data/datanba_2016.csv")
raw_pbp_2017_data <- read.csv("../data/datanba_2017.csv")
raw_pbp_2018_data <- read.csv("../data/datanba_2018.csv")
raw_pbp_2019_data <- read.csv("../data/datanba_2019.csv")
raw_pbp_2020_data <- read.csv("../data/datanba_2020.csv")
raw_pbp_2021_data <- read.csv("../data/datanba_2021.csv")
raw_pbp_2022_data <- read.csv("../data/datanba_2022.csv")

##print the first 15 rows of a sample of this raw data
head(raw_pbp_2022_data, n=15)

```

Now, we will create our cleaned data sets. Since we are dealing with the same type of data, it makes sense to create a function called `get_shots_data()` that will do this for us. 

```{r get-shot-data-function}
##the last name of the player, since that is what is in the pbp data
player_regex = "\\]\\s\\w+"
##to capture all "shot" from the play description
shot_literal_regex = "shot"
##to capture the team code
team_regex = "\\[[A-Z]{3}"


get_shots_data <- function(raw_pbp_data) {

  ##get the variables we use
  pbp_data <- raw_pbp_data %>% select(
    GAME_ID, PERIOD, cl, de, locX, locY, hs, vs
  )
  
  ##get the shot data
  shots_data <- pbp_data %>% 
    filter(str_detect(de, shot_literal_regex)) %>%
    group_by(GAME_ID) %>%
    ## responsible for getting the teams involved in this game
    mutate(
      team = str_extract(de, regex(team_regex, FALSE)),
      player_team = substring(team, 2, 5), 
    ) %>%
    ##responsible for getting the player shooting the shot
    mutate(
      player_identifier = str_extract(de, regex(player_regex, TRUE)), 
      player_shooting = substring(player_identifier, 3, last = 1000000L)
    ) %>% 
    ##responsible for classifying certain stage of the game in period.int format
    mutate(
      interval = case_when(
        cl <= "01:00" ~ 0.5,
        cl <= "03:00" ~ 0.4, 
        cl <= "06:00" ~ 0.3, 
        cl <= "09:00" ~ 0.2,
        cl <= "12:00" ~ 0.1), 
      stage_of_game = PERIOD + interval 
    ) %>% 
    ##QoL change
    rename(gm_quarter = PERIOD) %>%
    select(GAME_ID, gm_quarter, stage_of_game, de, hs, vs, player_shooting, player_team, locX, locY)
  
  return (shots_data)
}
```

Now we use `get_shots_data()` to get our cleaner shot data for each data set. Note, we are not done cleaning after this, but it is a nice intermediate step to have so that we can avoid running our ` r load_data` chunk. 

```{r get-shots-data}
##get the shots taken for the 2021-2022 NBA season
inter_shots_2022 <- get_shots_data(raw_pbp_data = raw_pbp_2022_data)

##get the shots taken for the 2020-2021 NBA season
inter_shots_2021 <- get_shots_data(raw_pbp_data = raw_pbp_2021_data)

##get the shots taken for the 2019-2020 NBA season
inter_shots_2020 <- get_shots_data(raw_pbp_data = raw_pbp_2020_data)

##get the shots taken for the 2018-2019 NBA season
inter_shots_2019 <- get_shots_data(raw_pbp_data = raw_pbp_2019_data)

##get the shots taken for the 2017-2018 NBA season
inter_shots_2018 <- get_shots_data(raw_pbp_data = raw_pbp_2018_data)

##get the shots taken for the 2016-2017 NBA season
inter_shots_2017 <- get_shots_data(raw_pbp_data = raw_pbp_2017_data)

##get the shots taken for the 2015-2016 NBA season
inter_shots_2016 <- get_shots_data(raw_pbp_data = raw_pbp_2016_data)

##print out a sample of what these data frames look like
head(inter_shots_2017, n=10)
```


#### Translating Location to Shots


Now that we have all of our shots, it's time to classify each shot. Before we do, we need to understand what `locX` and `locY` are all about. 


`locX` and `locY` are the standard media coordinates used by the NBA teams to locate where a player is with reference to the basketball court. 

For reference, let $x$ represent `locX` and $y$ represent `locY` such that a player's position $P$ on the court at any given moment is $P = (x, y)$. The origin of this system is the site of the jumpball, the immediate center. For now, we define the origin as $O$. We will give specific numerical coordinates to $x$ and $y$ at $O$ when we investigate our translation work. 

Additionally, let $x_r$ represent the traditional x coordinate in the Cartesian plane that `R` uses for its graphs. Consequently, let $y_r$ represent the traditional y coordinate in the Cartesian plane that `R` uses for its graphs. Then, with respect to any traditional graph that `R` uses, we define a position $P_r$ as the generalized location of any point on these collection of graphs that `R` uses such that $P_r = (x_r, y_r)$. Naturally, this means $P_r$ has origin $O_r = (0, 0)$

Our task is to then translate $O$ to $O_r$ to make `loc_X` and `loc_Y` plot-friendly in `R`. Once we do so, we can then classify shots using this translated plane as our reference geometry. 



### Analysis 1: 

[Placeholder]

### Analysis 2: 

[Placeholder]

# Discussion

In this section, we will discuss the results of our tests and models and their implications in the context of our question and also their broader implications and limitations. 

### Comparing the Graphs & Overall Conclusions

#### Graph Comparisons Discussion

[Placeholder]

### Shortcomings and Limitations


#### Limitation 1

[Placeholder]

#### Limitation 2

[Placeholder]

### Alternate Approaches


#### Alternate Approach 1

[Placeholder]

#### Alternate Approach 2

[Placeholder]
 
### Potential Future Directions

[Placeholder]

# References
